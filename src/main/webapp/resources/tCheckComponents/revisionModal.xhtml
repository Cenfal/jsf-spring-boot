<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:composite="http://xmlns.jcp.org/jsf/composite"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">
<h:head></h:head>
<h:body>
	<composite:interface>
		<composite:attribute name="selectorClass" required="true" />
		<composite:attribute name="title" />
		<composite:attribute name="equipment" />
		<composite:attribute name="selectedRevisionCycle" />
		<composite:attribute name="revisionsCycle" />
		<composite:attribute name="actionRevisionChanged" required="true"
			method-signature="void listener()" />
		<composite:attribute name="newRevision" />
		<composite:attribute name="hasFile" />
		<composite:attribute name="initialize" />
		<composite:attribute name="file"
			method-signature="void listener(org.primefaces.event.FileUploadEvent)" />
		<composite:attribute name="revisionFile" />
		<composite:attribute name="disable" />
		<composite:attribute name="newTaskName" />
		<composite:attribute name="checklist" />
		<composite:attribute name="hUpload"
			method-signature="void listener(org.primefaces.event.FileUploadEvent)" />
		<composite:attribute name="lines" />
		<composite:attribute name="tasks" />
		<composite:attribute name="isInTask" />
		<composite:attribute name="selectedTask" />
		<composite:attribute name="newTask" />
		<composite:attribute name="ajax" type="java.lang.Boolean"
			default="true" />
		<composite:attribute name="update" required="false" />
		<composite:attribute name="saveAction" required="true"
			method-signature="void action()" />
	</composite:interface>

	<composite:implementation>
		<div class="modal fade #{cc.attrs.selectorClass}" tabindex="-1"
			role="dialog" aria-labelledby="warehouseAssignationModal"
			aria-hidden="true" data-keyboard="false" data-backdrop="static">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<h:panelGroup id="content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal">
								<i class="fa fa-times" />
							</button>
							<h4>
								<h:outputText
									value="#{viewUtils.joinWithCommas(cc.attrs.equipment._Type, cc.attrs.equipment._Brand, cc.attrs.equipment._Model)}"
									styleClass="modal-header-title" />
							</h4>
							<p>
								<h:outputText value="#{msg.CODE}: " />
								<h:outputText value="#{cc.attrs.equipment._Code}"
									styleClass="modal-header-title" />
								<h:outputText value="#{msg.SERIAL_NUMBER}: "
									style="margin-left:20px;"
									rendered="#{cc.attrs._SerialNumber != ''}" />
								<h:outputText value="#{cc.attrs.equipment._SerialNumber}"
									styleClass="modal-header-title" />
							</p>
						</div>
						<div class="modal-body">
							<div class="container-fluid">
								<div class="row form-group">
									<p:outputLabel styleClass="col-md-3 control-label text-right">#{msg.REVISION_CYCLE}</p:outputLabel>
									<div class="col-md-8">
										<h:selectOneMenu disabled="#{cc.attrs.disable}"
											styleClass="form-control"
											converter="omnifaces.SelectItemsConverter" appendTo="@this"
											value="#{cc.attrs.selectedRevisionCycle}">
											<f:selectItems value="#{cc.attrs.revisionsCycle}"
												var="revision" itemLabel="#{revision._Name}"
												itemValue="#{revision}" />
											<p:ajax listener="#{cc.attrs.actionRevisionChanged}"
												update="@form:addNewRevision:content" />
										</h:selectOneMenu>
									</div>
								</div>


								<div class="row form-group">
									<p:outputLabel styleClass="col-md-3 control-label text-right"
										for="date" value="#{msg.DATE}" />
									<div class="col-md-8">
										<p:calendar id="date" required="true"
											value="#{cc.attrs.newRevision._StartDate}" locale="es"
											navigator="true" showWeek="true" pattern="dd/MM/yyyy HH:mm" />
									</div>
								</div>

								<h:panelGroup
									rendered="#{cc.attrs.selectedRevisionCycle._LastRevisionDate == null and not cc.attrs.isInTask}">
									<div class="row form-group">
										<div class="col-md-3 control-label text-right">
											<span data-toggle="tooltip" class="fa fa-info-circle"
												href="#"
												title="Inicializa la programación de revisión (calcular fecha de la próxima en base a la indicada)"
												aria-hidden="true" />
											<p:outputLabel>Inicializar</p:outputLabel>
										</div>
										<div class="col-md-2">
											<label class="switch"> <h:selectBooleanCheckbox
													value="#{cc.attrs.initialize}">
													<p:ajax process="@this"
														update="@form:addNewRevision:revisionContent @form:addNewRevision:taskContent @form:addNewRevision:summary" />
												</h:selectBooleanCheckbox>
												<div class="slider round"></div>
											</label>
										</div>
									</div>
									<script>
										$('[data-toggle=&quot;tooltip&quot;]')
												.tooltip();
									</script>
								</h:panelGroup>

								<h:panelGroup layout="block" id="taskContent"
									styleClass="row form-group">
									<ui:fragment rendered="#{not cc.attrs.initialize}">
										<p:outputLabel styleClass="col-md-3 control-label text-right">#{msg.TASK}</p:outputLabel>
										<ui:fragment rendered="#{!cc.attrs.newTask}">
											<div class="#{cc.attrs.isInTask ? 'col-md-8' : 'col-md-7'}">
												<h:selectOneMenu disabled="#{cc.attrs.isInTask}"
													styleClass="form-control"
													converter="omnifaces.SelectItemsConverter" appendTo="@this"
													value="#{cc.attrs.selectedTask}">
													<f:selectItem itemValue="#{null}"
														itemLabel="#{msg.NOT_ASSIGNED}" />
													<f:selectItems value="#{cc.attrs.tasks}" var="task"
														itemValue="#{task._Id}" itemLabel="#{task._Code}" />
												</h:selectOneMenu>
											</div>

											<h:panelGroup rendered="#{!cc.attrs.isInTask}"
												styleClass="col-md-2">
												<p:commandLink update="taskContent" process="@this"
													styleClass="btn btn-sm btn-default"
													actionListener="#{bean.showOrHideNewTaskInput(true)}"
													title="#{msg.TASK_NEW}">
													<h:outputText styleClass="fa fa-plus" />
												</p:commandLink>
											</h:panelGroup>
										</ui:fragment>
										<!-- NEW TASK -->
										<ui:fragment rendered="#{cc.attrs.newTask}">
											<div class="form-group">
												<div class="col-md-7">
													<p:inputText id="new_task_field"
														styleClass="form-control input-sm"
														required="#{cc.attrs.newTask}"
														value="#{cc.attrs.newTaskName}"
														placeholder="#{msg.TASK_NEW}" />
												</div>
												<div class="col-md-2">
													<p:commandLink update="taskContent" process="@this"
														styleClass="btn btn-sm btn-default"
														actionListener="#{bean.showOrHideNewTaskInput(false)}">
														<h:outputText styleClass="fa fa-times" />
													</p:commandLink>
												</div>
											</div>
										</ui:fragment>
									</ui:fragment>
								</h:panelGroup>


								<h:panelGroup layout="block" class="form-group"
									id="revisionContent">
									<h:panelGroup rendered="#{not cc.attrs.initialize}">

										<h:panelGroup rendered="#{not cc.attrs.initialize}">
											<div class="row form-group">
												<p:outputLabel
													styleClass="col-md-3 control-label text-right">Adjuntar documento</p:outputLabel>
												<div class="col-md-1">
													<p:selectBooleanCheckbox value="#{cc.attrs.hasFile}"
														disabled="#{empty cc.attrs.selectedRevisionCycle._IdCheckListTemplate}">
														<p:ajax process="@this"
															update="@form:addNewRevision:revisionContent" />
														<p:ajax process="@this" update="@parent" />
													</p:selectBooleanCheckbox>
												</div>
											</div>
										</h:panelGroup>

										<h:panelGroup id="attachedFileContainer"
											rendered="#{cc.attrs.hasFile}">
											<div class="row center-block">
												<div class="col-md-12 col-xs-3">
													<i class="fa fa-angle-right" /><span
														class="modal-header-title">#{msg.ATTACHED_FILE}</span>
												</div>
											</div>

											<div class="row center-block" style="margin-bottom: 15px;">
												<div class="col-md-11 tcheck-panel">
													<div class="form-group ">
														<p:fileUpload mode="advanced" skinSimple="false"
															cancelLabel="#{msg.CANCEL}" uploadLabel="Cargar"
															label="#{msg.SELECT}" auto="true"
															fileUploadListener="#{cc.attrs.file}"
															style="font-size:0.8em;" oncomplete="hideUploader(this);"
															update="revisionFilename" />
													</div>
													<h:panelGroup id="revisionFilename" layout="block"
														class="row">
														<div class="col-md-12">
															<h:outputText escape="false"
																rendered="#{cc.attrs.revisionFile != null}"
																value="&lt;i class=&quot;fa fa-file&quot; aria-hidden=&quot;true&quot;&gt;
															&lt;/i&gt; #{cc.attrs.revisionFile.getFileName()}"
																style="font-size:1em;" />
														</div>
													</h:panelGroup>
												</div>
											</div>
										</h:panelGroup>

										<h:panelGroup id="checklistContainer"
											rendered="#{cc.attrs.checklist.get_Lines().size() > 0 and not cc.attrs.hasFile}">
											<div class="row center-block" style="margin-bottom: 15px;">
												<div class="col-md-12 col-xs-12">
													<i class="fa fa-angle-right" /><span
														class="modal-header-title">#{msg.CHECKLIST}</span>
												</div>
											</div>

											<h:panelGroup layout="block" id="checklistLinesContainer"
												class="row center-block">
												<h:outputText value="No aplica"
													rendered="#{cc.attrs.checklist._Lines == null}" />
												<h:panelGroup id="fileUploadPanel" layout="block"
													styleClass="form-group"
													rendered="#{cc.attrs.checklist._Lines != null}">
													<div class="form-group ">
														<ui:repeat varStatus="status"
															value="#{cc.attrs.checklist._Lines}" var="line">
															<div class="col-md-11 tcheck-panel">
																<div class="row" style="margin-bottom: 10px;">
																	<div class="col-md-9">
																		<h:outputText escape="false"
																			value="&lt;span class=&quot;label label-default&quot;&gt;
						                			#{line._OrderValue+1}&lt;/span&gt;&lt;span style=&quot;font-size:.8em&quot;&gt; #{line._TextValue}&lt;/span&gt;"
																			style="margin-bottom:10px; font-weight:bold;" />
																	</div>
																	<div class="col-md-3 text-right">
																		<h:selectOneMenu styleClass="form-control input-sm"
																			appendTo="@this" value="#{line._Status}">
																			<f:selectItem itemLabel="Correcto" itemValue="OK" />
																			<f:selectItem itemLabel="Incorrecto"
																				itemValue="NO_OK" />
																			<f:selectItem itemLabel="No aplica"
																				itemValue="NO_APPLY" />
																		</h:selectOneMenu>
																	</div>
																</div>
																<div class="row">
																	<div class="col-md-12">
																		<h:inputTextarea value="#{line._Annotations}"
																			pt:placeholder="#{msg.ANNOTATIONS}"
																			styleClass="form-control input-sm unresizable"
																			style="margin-bottom:10px;">
																		</h:inputTextarea>
																	</div>
																</div>
																<div class="row">
																	<div class="col-md-12">
																		<p:graphicImage
																			rendered="#{cc.attrs.lines.containsKey(line._OrderValue)}"
																			value="#{cc.attrs.lines.get(line._OrderValue).streamedContent}" />
																		<p:fileUpload fileUploadListener="#{cc.attrs.hUpload}"
																			mode="advanced" dragDropSupport="false" fileLimit="3"
																			allowTypes="/(\.|\/)(gif|jpe?g|png)$/" auto="true"
																			label="#{msg.ADD_IMAGE}" style="font-size:0.8em;"
																			update="filename">
																			<f:attribute name="orderValue"
																				value="#{line._OrderValue}" />
																		</p:fileUpload>
																	</div>
																</div>

																<h:panelGroup id="filename" layout="block" class="row">
																	<div class="col-md-12">
																		<h:outputText escape="false"
																			rendered="#{cc.attrs.lines.get(line._OrderValue) != null}"
																			value="&lt;i class=&quot;fa fa-file&quot; aria-hidden=&quot;true&quot;&gt;
															&lt;/i&gt; #{cc.attrs.lines.get(line._OrderValue).getFileName()}"
																			style="font-size:1em;" />
																	</div>
																</h:panelGroup>
															</div>
														</ui:repeat>
													</div>
												</h:panelGroup>
											</h:panelGroup>
										</h:panelGroup>
									</h:panelGroup>
								</h:panelGroup>

								<h:panelGroup id="summary">

									<ui:fragment rendered="#{not cc.attrs.initialize}">

										<div class="row center-block" style="margin-bottom: 15px;">
											<div class="col-md-12">
												<i class="fa fa-angle-right" /><span
													class="modal-header-title">Resumen</span>
											</div>
										</div>

										<div class="col-md-11"
											style="margin-bottom: 25px; margin-left: 15px; background-color: #C1D5DF; padding: 20px; border: 1px dashed #003D50;">
											<div class="row center-block" style="margin-bottom: 20px;">
												<div class="form-group ">
													<div class="col-md-6" style="margin-bottom: 10px;">
														<h:selectOneMenu styleClass="form-control input-sm"
															appendTo="@this" value="#{cc.attrs.newRevision._Status}">
															<f:selectItem itemLabel="#{msg.CORRECT}" itemValue="OK" />
															<f:selectItem itemLabel="#{msg.INCORRECT}"
																itemValue="NO_OK" />
														</h:selectOneMenu>
													</div>
													<div class="col-md-11">
														<h:inputTextarea pt:placeholder="#{msg.ANNOTATIONS}"
															styleClass="form-control input-sm unresizable"
															style="margin-bottom:10px;"
															value="#{cc.attrs.newRevision._Observations}" />
													</div>
													<div class="col-md-11">
														<h:inputTextarea pt:placeholder="#{msg.ADVICE}"
															styleClass="form-control input-sm unresizable"
															style="margin-bottom:10px;"
															value="#{cc.attrs.newRevision._Advice}" />
													</div>
												</div>
											</div>
										</div>
									</ui:fragment>
								</h:panelGroup>
							</div>
						</div>
						<div class="modal-footer">
							<ui:fragment rendered="#{cc.attrs.ajax}">
								<p:commandButton value="#{msg.SAVE}"
									action="#{cc.attrs.saveAction}" styleClass="btn btn-default"
									oncomplete="if (args &amp;&amp; !args.validationFailed) $('.equipmentAddNewRevisionModal').modal('hide');"
									update="#{cc.attrs.update}" />
							</ui:fragment>
							<ui:fragment rendered="#{not cc.attrs.ajax}">
								<p:commandButton ajax="false" value="#{msg.SAVE}"
									action="#{cc.attrs.saveAction}" styleClass="btn btn-default" />
							</ui:fragment>
						</div>
					</h:panelGroup>
				</div>
			</div>
		</div>
	</composite:implementation>
</h:body>
</html>